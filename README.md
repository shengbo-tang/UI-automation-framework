[# UI-automation-framework

## UI自动化框架编写步骤及实现思路

### 一、PO设计模式基础
#### 1、新开框架
1、新建一个元素信息包element_info，存放我们的页面
login_page.py
main_page.py

2、新建login_page.py，添加属性、方法

3、新建驱动文件夹，导入驱动文件

4、新建一个main_page.py


#### 2、增加了日志模块，利于bug定位
1、在用例内部添加日志模块，打印操作日志


小结：

1、封装log_utils工具类

2、避免一行日志出现多行的情况，在log_utils.py添加了一个logger对象

---
### 二、框架第二节课

界面层：界面的元素

控件层：单独验证每个控件的功能

功能层：单个或者多个功能组合操作形成的功能

业务层：单个或多个功能形成业务

###### PO模式分层和线性脚本的比较
线性脚本：按操作取识别元素，识别一个元素操作一个，风险比较小

pageobject模式模型：先全部识别元素，然后再进行操作

####### 问题引出
pageobject模式是实例化页面之后，需要识别所有的元素，然后再去操作，可能出现元素
不能识别的元素

**处理方法**：识别数据分离，实例化对象的时候不识别元素，操作的时候再去识别。

**思路：**

1、在common中创建一个base_page.py --> BasePage 类

2、页面层元素识别方法，改为不用识别好元素，只需要识别到元素的信息

3、在BasePage类中封装元素识别方法

4、完善login_page.py中的LoginPage 继承 BasePage类

**BasePage类：浏览器操作、元素识别、元素操作（切框架、切句柄等等）**

**小结**

1、在页面类拿到元素的识别信息字典-->通过BasePage里面的元素识别方法获取一个元素-->然后再操作元素
-->在页面类里面再根据具体的业务封装操作

---
### 框架03--元素信息分离设计

**思路**：元素识别信息数据放在代码中是否好维护


**数据的类型：**

1、元素识别数据

2、配置数据（URL、路径、邮箱）

3、测试用例数据

**数据与代码的分离**

1、数据放在ini配置文件中

2、放excel表中

3、放mysql

4、放yaml文件中

**数据放Excel表中思路**

1、新建一个element_info_datas 文件夹，把元素识别的数据放Excel表中

2、步骤2：编写测试代码，读取Excel表中的数据元素识别数据

3、把读取Excel的代码封装element_data_utils.py文件中

4、步骤4：改造LoginPage，从Excel中拿元素识别数据

---
### 框架04--driver的二次封装及页面类的拆分

**要点**

1、增加了config文件夹，并在其中增加config.ini配置文件

2、封装config_utils.py读取.ini文件的底层方法

3、封装了browser.py 浏览器类，用来提取driver


**步骤**

1、element_data_utils_2.py 方法二读取Excel文件方式

**小结：** 动态变化的数据，通过业务数据来识别

---
### 框架05--base_page.py封装实战

***实战1***

1、在base_page封装切框架

2、执行js的封装

3、封装等待时间

4、鼠标事件的封装

5、弹出框的封装

6、截图的封装

7、分区域存放封装

---
### 框架06--功能层的编写

**功能层：** 把页面单个元素的操作组合成一个功能，或者完成一个业务操作，例如：登录、下单、发货、
退出

**actions**

---
### 框架07--用例层的编写

**前置操作：** 在BasePage封装关闭浏览器操作

**步骤1：** 编写登录的测试用例

**步骤2：** 重写MainPage类

**步骤3：** 完善登录的测试用例


**思路:**

0、不熟悉的情况下，可以先编写线性脚本

1、在数据层的元素识别excel添加元素识别信息

2、在页面层中main_page.py添加元素

3、在页面层中main_page.py添加元素的操作

4、编写动作类

5、编写测试用例类

6、执行当前测试用例，查看结果

**步骤1：** 讲解一个知识点 setUpClass()、setUp()前置方法讲解

**步骤2：** 测试类的基类封装

在common-->selenium_base_case.py编写SeleniumBaseCase()类，这个基类
继承于unittest.TestCase

**步骤3：** 改造之前编写的用例，继承SeleniumBaseCase()类，删除前置方法、后置方法

**步骤4：** 个性化设置

**步骤5：** 扩展。如果断言失败，加错误截图--后续再讲解

---

### 框架08--提交bug用例--作业

作业：初步完成了第三条用例
修复了base_page.py中的 clear 方法
完成了提交bug步骤的用例--页面层-动作层-case层

---

### 框架09--代码注释

块注释

"#" 号后空一格

位置：.py文件开始或者方法开始的地方写

行注释：在代码关键的地方

""""""

####作用：在代码中加入注释，是代码更加清晰，后续更新时更容易理解

---

### 框架10--封装读取测试用例的工具类ExcelUtils()

1、封装excel_utils.py基础读取测试用例数据类，以列表形式返回

2、日志模块的封装
    
    1.输出日志到控制台
    2.输出日志到文件

3、日志的级别
    
    noset = 0   
    DEBUG = 10   
    INFO = 20  
    WARING = 30  
    ERROR = 40  
    CRITICAL = 50

4、引入日志模块的思路
    
    1.在common封装一个log.utils.py文件，然后在里面新建一个日志对象
    2.在config.ini把日志文件添加进去
    3.为了控制日志的级别，把日志级别的配置也写入config.ini文件中
    4.在common->ConfigUtils.py中添加获取方法
    5.在框架底层代码中添加日志
    6.调整日志级别，控制日志输出

5、在框架底层代码中添加日志

#####要求：
    1.从框架最开始的地方开始添加日志
    2.尽量把日志添加到框架底层

---

### 框架11--代码异常处理

#### 异常报错的类型分析

断言异常 代码运行失败

    1.数据错误
    2.自动化过程问题
    3.软件bug

#### 问题1：元素识别失败的处理
添加异常日志

###### 步骤1：登录页面元素Excel故意写错，演示断言错误
###### 步骤2：在BasePage()类中元素识别加异常处理
###### 步骤3：先把元素识别错误去掉，改回正确的数据，在登录成功的前面加上AA，使用手工登录禅道，输入错误的密码，让错误提示变了
###### 步骤4：在元素操作里面加异常日志
###### 步骤5：添加元素识别错误截图

---

### 框架12--测试数据设计
####思路
    
    1.测试用例分析
    2.使用Excel表设计用例
    3.把测试用例数据路径添加到配置文件中
    4.先使用Excel_utils.py测试一下读取数据
    5.创建test_data_utils.py去读取测试数据
    6.对LoginCase()测试类进行改造，从Excel表中导入测试数据
    7.执行代码，查看结果，验证是否成功

##### 将代码中的测试数据分离出来，直接读取test_data目录下的测试用例Excel表

---

### 框架13--执行测试用例后生成报告

##### 思路：
    步骤1、新建报告结果文件夹和执行层文件夹
    步骤2、在配置文件中添加信息
    步骤3、在common中导入HTMLTestReportCN.py模块
    步骤4、编写执行层脚本 run_all_case.py
    步骤5、执行 run_all_case.py 查看结果
    步骤6、重新封装错误截图，在报告中添加截图
    步骤7、元素识别错误，执行Excel中的元素识别信息
    步骤8、该测试用例预期结果数据，让断言报错，但没有截图，需要在selenium_base_case.py类中添加断言失败介入的方法


---

### 框架14--控制用例是否执行

element_data_utils.py 中添加判断用例是否执行代码

---

### 框架15--邮件发送测试报告

步骤1：编写测试代码，先发送一个文本的邮件

步骤2：编写一个带附件的邮件

步骤3：压缩文件夹代码

步骤4：压缩文件代码整合到框架

步骤5：把压缩文件打包功能封装到发送邮件汇总

步骤6：把邮件的用户名、密码等信息分离到配置文件中

步骤7：执行，查看结果是否可以收到，附件为测试结果打包的文件夹

